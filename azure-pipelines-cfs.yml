resources:
- repo: self

trigger:
  batch: true
  branches:
    include:
    - '*'

pr:
  branches:
    include:
    - '*'

variables:
- template: ${{ variables.Pipeline.Workspace }}/.azure-pipelines/templates/variables.yml
- name: Codeql.Enabled
  value: false
- name: PIP_INDEX_URL

jobs:
- job: AddWindowsDependencies
  displayName: Add Windows Dependencies
  pool:
    name: ${{ variables.windows_pool }}
  steps:
  - task: UsePythonVersion@0
    displayName: 'Use Python 3.11'
    inputs:
      versionSpec: 3.11
  - task: PipAuthenticate@1
    displayName: 'Pip Authenticate'
    inputs:
      artifactFeeds: 'public/azure-cli-feed'
  - powershell: |
      python3 -m venv venv
      pip install -U pip setuptools
      ./venv/Scripts/Activate.ps1
      pip install -r src/azure-cli/requirements.py3.windows.txt
      pip install azure-cli azure-cli-core azure-cli-telemetry

- job: AddUbuntuDependencies
  displayName: Add Ubuntu Dependencies
  pool:
    name: ${{ variables.ubuntu_pool }}
  steps:
  - task: UsePythonVersion@0
    displayName: 'Use Python 3.11'
    inputs:
      versionSpec: 3.11
  - task: PipAuthenticate@1
    displayName: 'Pip Authenticate'
    inputs:
      artifactFeeds: 'public/azure-cli-feed'
  - bash: |
      set -ev
      python3 -m venv venv
      pip install -U pip setuptools
      source ./venv/bin/activate
      pip install -r src/azure-cli/requirements.py3.windows.txt
      pip install azure-cli azure-cli-core azure-cli-telemetry 

- job: AddMacosDependencies
  displayName: Add macOS Dependencies
  pool:
    vmImage: ${{ variables.macos_pool }}
  steps:
  - task: UsePythonVersion@0
    displayName: 'Use Python 3.11'
    inputs:
      versionSpec: 3.11
  - task: PipAuthenticate@1
    displayName: 'Pip Authenticate'
    inputs:
      artifactFeeds: 'public/azure-cli-feed'
  - bash: |
      set -ev
      python3 -m venv venv
      pip install -U pip setuptools
      source ./venv/bin/activate
      pip install -r src/azure-cli/requirements.py3.windows.txt
      pip install azure-cli azure-cli-core azure-cli-telemetry

